<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->

<!--<head>-->
<!--	<meta charset="UTF-8">-->
<!--	<link rel="stylesheet" th:href="@{/style.css}">-->

<!--	<title>顔認証</title>-->
<!--</head>-->

<!--<body>-->
<!--	<div class="container">-->

<!--		<img src="/images/peace.png" width="300">-->

<!--		<form method="post" th:action="@{/face/authenticate}">-->
<!--			<button type="submit" name="finger" value="1">1</button>-->
<!--			<button type="submit" name="finger" value="2">2</button>-->
<!--			<button type="submit" name="finger" value="3">3</button>-->
<!--		</form>-->

<!--		<br>-->
<!--		<a th:href="@{/}">トップに戻る</a>-->
<!--	</div>-->
<!--</body>-->

<!--</html>-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>カメラ表示</title>
</head>
<div class="container">
	<h1>カメラ映像</h1>
	<video id="video" autoplay playsinline width="400"></video>
	<p id="message"></p>
	<p id="selected"></p>

	<script>
		let selectedAction = 'start'; // デフォルトは出勤

		// キー入力で選択
		document.addEventListener('keydown', (event) => {
			const key = event.key;
			if (key === '1') {
				selectedAction = 'start';
				document.getElementById('selected').innerText = "選択: 出勤";
			} else if (key === '2') {
				selectedAction = 'end';
				document.getElementById('selected').innerText = "選択: 退勤";
			}
		});

		// カメラ起動
		navigator.mediaDevices.getUserMedia({video: true})
			.then(stream => {
				document.getElementById('video').srcObject = stream;
			})
			.catch(error => {
				console.error("カメラの取得に失敗しました", error);
			});

		// 3秒後に処理
		setTimeout(() => {
			document.getElementById('message').innerText = "判定中...";

			fetch('/face/attendance?type=' + selectedAction, {method: 'POST'})
				.then(response => {
					if (response.ok) {
						if (selectedAction === 'start') {
							document.getElementById('message').innerText = "✅ 出勤しました";
						} else {
							document.getElementById('message').innerText = "✅ 退勤しました";
						}
					} else {
						document.getElementById('message').innerText = "❌ エラーが発生しました";
					}
				})
				.catch(error => {
					console.error('通信エラー', error);
					document.getElementById('message').innerText = "❌ 通信エラー";
				});

		}, 3000);
	</script>
	<p><a th:href="@{/attendance}">手入力で出退勤</a></p>
</div>

</html>